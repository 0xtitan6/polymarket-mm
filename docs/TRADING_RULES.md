# Trading Rules

This document defines the rules that gate market selection and trade execution.

## 1) Market Universe Rules

The scanner only considers markets that pass all hard filters:

- `active == true`
- `closed == false`
- `acceptingOrders == true`
- `enableOrderBook == true`
- `liquidity >= scanner.min_liquidity`
- `volume24hr >= scanner.min_volume_24h`
- `spread >= scanner.min_spread`
- `endDate` parses and is within `now .. now + scanner.max_end_date_days`
- `clobTokenIds` is present

### Optional include filters (allowlists)

If any include filter is set, a market must match at least one:

- `scanner.include_condition_ids` exact match on `conditionId`
- `scanner.include_slugs` exact match on `slug`
- `scanner.include_keywords` substring match on `slug` or `question` (case-insensitive)

### Exclusions

- `scanner.exclude_slugs` always wins (exclude overrides include).
- `scanner.exclude_keywords` also wins (case-insensitive substring on `slug`/`question`).

## 2) Quote Eligibility Rules

A market strategy only quotes when all of the following are true:

- Order book is not stale (`strategy.stale_book_timeout`)
- Mid price is available from current book
- Kill switch is not active
- Remaining risk budget for market/global exposure is positive

If any condition fails, the strategy cancels its live orders for that market.

## 3) Quote Construction Rules

Quotes are generated by Avellaneda-Stoikov with flow-toxicity widening:

- Reservation price and spread use configured `gamma`, `sigma`, `k`, `t`
- Minimum spread floor from `strategy.default_spread_bps`
- Spread can be widened up to `flow_max_spread_multiplier` when toxicity is high
- Prices are clamped to valid market bounds and rounded to market tick size
- Quote size scales down as inventory skew increases
- Combined bid+ask quoted notional is capped by remaining risk budget

## 4) Risk Rules

Risk manager enforces:

- Per-market exposure cap (`risk.max_position_per_market`)
- Global exposure cap (`risk.max_global_exposure`)
- Daily loss cap (`risk.max_daily_loss`)
- Rapid price move kill switch (`risk.kill_switch_drop_pct` over `risk.kill_switch_window_sec`)
- Cooldown lockout after kill (`risk.cooldown_after_kill`)

On kill, the engine cancels orders and stops affected markets.

## 5) Execution Rules

- Orders are EIP-712 signed before submit (salt + signature required).
- Batch submit max is 15 orders.
- If the local desired quote differs materially from resting quote, stale orders are canceled and replaced.
- On market startup, the bot cancels any pre-existing resting orders for that market before quoting.

## 6) Recommended Live Operator Policy (BTC First)

- Use explicit `include_condition_ids` and/or `include_slugs` for approved BTC markets.
- Keep `include_keywords` narrowed to approved BTC market families.
- Use `exclude_keywords` to block short-horizon contracts (for example 5m/15m).
- Start in `dry_run: true`; switch live only after log/health validation.
- Begin with conservative limits and one market (`risk.max_markets_active: 1`).
- Add ETH/SOL only after BTC performance is stable; then append ETH/SOL patterns to `include_keywords`.
